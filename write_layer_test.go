package vt

import (
	"github.com/paulmach/go.geojson"
	"testing"
	m "github.com/murphy214/mercantile"
	//"fmt"
)

var fc_s = `{"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-7.734375,25.799891182088302],[10.8984375,-34.016241889667015],[45.703125,17.644022027872722],[-6.064453125,26.431228064506442],[-7.734375,25.799891182088302]]]},"properties":null},{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[-71.806640625,51.17934297928926],[-36.2109375,-49.1529696561704],[30.5859375,0.3515602939922644],[29.1796875,59.17592824927135],[-38.3203125,70.72897946208789],[-71.806640625,51.17934297928926]]],[[[33.3984375,74.68325030051861],[75.234375,16.299051014581835],[76.2890625,64.7741253129287],[32.6953125,75.25305660483545],[33.3984375,74.68325030051861]]]]},"properties":null},{"type":"Feature","geometry":{"type":"LineString","coordinates":[[10.8984375,56.17002298293204],[16.5234375,-2.108898659243124],[59.4140625,42.03297433244137],[61.171875,42.293564192170095]]},"properties":null},{"type":"Feature","geometry":{"type":"MultiLineString","coordinates":[[[-48.1640625,47.75409797968001],[-9.140625,4.214943141390634],[15.46875,-9.102096738726445]],[[10.8984375,56.17002298293204],[16.5234375,-2.108898659243124],[59.4140625,42.03297433244137],[61.171875,42.293564192170095]]]},"properties":null},{"type":"Feature","geometry":{"type":"Point","coordinates":[-48.1640625,47.75409797968001]},"properties":null},{"type":"Feature","geometry":{"type":"MultiPoint","coordinates":[[-48.1640625,47.75409797968001],[-9.140625,4.214943141390634]]},"properties":null},{"type":"Feature","geometry":{"type":"Point","coordinates":[49.921875,50.007739014636854]},"properties":{"boolkey":true,"doublekey":100.23,"floatkey":100.23,"intkey":10201203912,"stringkey":"string","uintkey":10201203912}}]}`
var fc,_ = geojson.UnmarshalFeatureCollection([]byte(fc_s))

var tile_expected = []byte{0x1a, 0xa4, 0x2, 0xa, 0x7, 0x74, 0x65, 0x73, 0x74, 0x69, 0x6e, 0x67, 0x12, 0x19, 0x18, 0x3, 0x22, 0x15, 0x9, 0xd0, 0x1e, 0xa0, 0x1b, 0x22, 0xa8, 0x3, 0x98, 0xb, 0x98, 0x6, 0xcf, 0x9, 0x99, 0x9, 0xd7, 0x1, 0x25, 0x10, 0xf, 0x12, 0x32, 0x18, 0x3, 0x22, 0x2e, 0x9, 0x9e, 0x13, 0xb0, 0x15, 0x2a, 0xaa, 0x6, 0xd8, 0x14, 0xf0, 0xb, 0x8f, 0xa, 0x1f, 0x87, 0xd, 0xff, 0xb, 0xf7, 0x4, 0xf9, 0x5, 0xb8, 0x7, 0xf, 0x9, 0xda, 0x12, 0xe7, 0x9, 0x22, 0xb8, 0x7, 0xc0, 0x11, 0x18, 0xa7, 0xc, 0xdf, 0x7, 0xc9, 0x5, 0x10, 0x32, 0xf, 0x12, 0x14, 0x18, 0x2, 0x22, 0x10, 0x9, 0xf8, 0x21, 0xf0, 0x13, 0x1a, 0x80, 0x1, 0xc0, 0xc, 0xd0, 0x7, 0xcf, 0x8, 0x28, 0x7, 0x12, 0x21, 0x18, 0x2, 0x22, 0x1d, 0x9, 0xb8, 0x17, 0xa8, 0x16, 0x12, 0xf8, 0x6, 0xf8, 0x8, 0xb0, 0x4, 0xb0, 0x2, 0x9, 0x67, 0xdf, 0xd, 0x2a, 0x80, 0x1, 0xc0, 0xc, 0xd0, 0x7, 0xcf, 0x8, 0x28, 0x7, 0x12, 0x9, 0x18, 0x1, 0x22, 0x5, 0x9, 0xb8, 0x17, 0xa8, 0x16, 0x12, 0xd, 0x18, 0x1, 0x22, 0x9, 0x11, 0xb8, 0x17, 0xa8, 0x16, 0xf8, 0x6, 0xf8, 0x8, 0x12, 0x17, 0x12, 0xc, 0x0, 0x0, 0x1, 0x0, 0x2, 0x1, 0x3, 0x2, 0x4, 0x1, 0x5, 0x3, 0x18, 0x1, 0x22, 0x5, 0x9, 0xf0, 0x28, 0xda, 0x15, 0x1a, 0x9, 0x64, 0x6f, 0x75, 0x62, 0x6c, 0x65, 0x6b, 0x65, 0x79, 0x1a, 0x8, 0x66, 0x6c, 0x6f, 0x61, 0x74, 0x6b, 0x65, 0x79, 0x1a, 0x6, 0x69, 0x6e, 0x74, 0x6b, 0x65, 0x79, 0x1a, 0x9, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x6b, 0x65, 0x79, 0x1a, 0x7, 0x75, 0x69, 0x6e, 0x74, 0x6b, 0x65, 0x79, 0x1a, 0x7, 0x62, 0x6f, 0x6f, 0x6c, 0x6b, 0x65, 0x79, 0x22, 0x9, 0x19, 0x1f, 0x85, 0xeb, 0x51, 0xb8, 0xe, 0x59, 0x40, 0x22, 0x9, 0x19, 0x0, 0x0, 0x40, 0x26, 0x50, 0x0, 0x3, 0x42, 0x22, 0x8, 0xa, 0x6, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x22, 0x2, 0x38, 0x1, 0x78, 0x2}


func TestWriteLayer(t *testing.T) {
	config := NewConfig("testing",m.TileID{0,0,0})
	bytevals := WriteLayer(fc.Features,config)
	if len(tile_expected) != len(bytevals) {
		t.Errorf("writelayer test failed %d %d",len(tile_expected),len(bytevals))
	}
}